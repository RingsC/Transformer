#add the directory to top

#includes the sub-directory cmake files in.
include(parser/parser.cmake)
include(analyze/analyze.cmake)
include(rewrite/rewrite.cmake)
include(optimizer/optimizer.cmake)

#lex.cmake included.
#this is import notice: the header files in :include/query/parse/lex/scanner.h is NOT auto-generated file. it's use for lex scanner.
#the header file,scanner_lex.h, is auto-generated by FLEX. not overried scanner.h with same name. be patient. 
include(${CMAKE_MODULE_PATH}/lex.cmake)
RUN_LEX(${CMAKE_CURRENT_SOURCE_DIR}/parser/lex/scanner.l ${CMAKE_CURRENT_SOURCE_DIR}/parser/lex/scanner.cpp ${PROJECT_SOURCE_DIR}/src/include/query/parser/lex/scanner_lex.h)
message(STATUS "The Lex file has been processed, source and header files generated.")

#bison.cmake included.
include(${CMAKE_MODULE_PATH}/bison.cmake)
RUN_BISON(${CMAKE_CURRENT_SOURCE_DIR}/parser/grammar.y ${CMAKE_CURRENT_SOURCE_DIR}/parser/grammar.cpp ${PROJECT_SOURCE_DIR}/src/include/query/parser/grammar.h)
message(STATUS "The BISON file has been processed. ${PROJECT_SOURCE_DIR}/src/include/query/parser/grammar.h generated.")



#set the query files
set(query
	${query}
	${optimize}
	${parser}
	${rewrite}
	${analyze}
)

#the libs which is neeed by Query when we built Query dynamic library.
#set(query_DEPENDENCY
#)

add_library(Query SHARED ${query})
#add_dependencies(Query ${query_DEPENDENCY})
#target_link_libraries(Query ${Query_DEPENDENCY})

install(TARGETS Query
	RUNTIME DESTINATION bin
	LIBRARY DESTINATION bin
	COMPONENT core
)
